{"ast":null,"code":"import _asyncToGenerator from\"C:/Users/Alice/Desktop/vk4/who/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/Alice/Desktop/vk4/who/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"C:\\\\Users\\\\Alice\\\\Desktop\\\\vk4\\\\who\\\\node_modules\\\\@babel\\\\runtime\\\\regenerator\\\\index.js\";import'./App.css';import'@vkontakte/vkui/dist/vkui.css';import bridge from'@vkontakte/vk-bridge';import React,{useState,useEffect}from'react';import{ChooseFriend}from'./components/choosеFriend/СhooseFriend';import{View,ScreenSpinner,AdaptivityProvider,AppRoot,ConfigProvider,SplitLayout,SplitCol}from'@vkontakte/vkui';import Home from'./components/home/Home';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var App=function App(){var ROUTES={HOME:'home',CHOOSEFRIEND:'chooseFriend'};var STORAGE_KEYS={STATE:'state',STATUS:'viewStatus'};var _useState=useState(ROUTES.HOME),_useState2=_slicedToArray(_useState,2),activePanel=_useState2[0],setActivePanel=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),fetchedUser=_useState4[0],setUser=_useState4[1];var _useState5=useState(/*#__PURE__*/_jsx(ScreenSpinner,{size:\"large\"})),_useState6=_slicedToArray(_useState5,2),popout=_useState6[0],setPopout=_useState6[1];var _useState7=useState(null),_useState8=_slicedToArray(_useState7,2),fetchedState=_useState8[0],setFetchedState=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),userHasSeenIntro=_useState10[0],setUserHasSeenIntro=_useState10[1];useEffect(function(){bridge.subscribe(function(_ref){var _ref$detail=_ref.detail,type=_ref$detail.type,data=_ref$detail.data;if(type==='VKWebAppUpdateConfig'){var schemeAttribute=document.createAttribute('scheme');schemeAttribute.value=data.scheme?data.scheme:'client_light';document.body.attributes.setNamedItem(schemeAttribute);}});function fetchData(){return _fetchData.apply(this,arguments);}function _fetchData(){_fetchData=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var user,sheetState,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return bridge.send('VKWebAppGetUserInfo');case 2:user=_context.sent;_context.next=5;return bridge.send('VKWebAppStorageGet',{keys:[STORAGE_KEYS.STATE,STORAGE_KEYS.STATUS]});case 5:sheetState=_context.sent;if(Array.isArray(sheetState.keys)){data={};sheetState.keys.forEach(function(_ref2){var key=_ref2.key,value=_ref2.value;try{data[key]=value?JSON.parse(value):{};switch(key){case STORAGE_KEYS.STATE:setFetchedState(data[STORAGE_KEYS.STATE]);break;case STORAGE_KEYS.STATUS:if(data[key]&&data[key].hasSeenIntro){setActivePanel(ROUTES.HOME);setUserHasSeenIntro(true);}break;default:break;}}catch(error){setSnackbar(/*#__PURE__*/_jsx(Snackbar,{layout:\"vertical\",onClose:function onClose(){return setSnackbar(null);},before:/*#__PURE__*/_jsx(Avatar,{size:24,style:{backgroundColor:'var(--dynamic_red)'},children:/*#__PURE__*/_jsx(Icon24Error,{fill:\"#fff\",width:14,height:14})}),duration:900,children:\"\\u041F\\u0440\\u043E\\u0431\\u043B\\u0435\\u043C\\u0430 \\u0441 \\u043F\\u043E\\u043B\\u0443\\u0447\\u0435\\u043D\\u0438\\u0435\\u043C \\u0434\\u0430\\u043D\\u043D\\u044B\\u0445 \\u0438\\u0437 Storage\"}));setFetchedState({});}});}else{setFetchedState({});}setUser(user);setPopout(null);case 9:case\"end\":return _context.stop();}}},_callee);}));return _fetchData.apply(this,arguments);}fetchData();},[]);var go=function go(e){setActivePanel(e.currentTarget.dataset.to);};var viewIntro=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(panel){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return bridge.send('VKWebAppStorageSet',{key:STORAGE_KEYS.STATUS,value:JSON.stringify({hasSeenIntro:true})});case 3:go(panel);_context2.next=9;break;case 6:_context2.prev=6;_context2.t0=_context2[\"catch\"](0);setSnackbar(/*#__PURE__*/_jsx(Snackbar,{layout:\"vertical\",onClose:function onClose(){return setSnackbar(null);},before:/*#__PURE__*/_jsx(Avatar,{size:24,style:{backgroundColor:'var(--dynamic_red)'},children:/*#__PURE__*/_jsx(Icon24Error,{fill:\"#fff\",width:14,height:14})}),duration:900,children:\"\\u041F\\u0440\\u043E\\u0431\\u043B\\u0435\\u043C\\u0430 \\u0441 \\u043E\\u0442\\u043F\\u0440\\u0430\\u0432\\u043A\\u043E\\u0439 \\u0434\\u0430\\u043D\\u043D\\u044B\\u0445 \\u0432 Storage\"}));case 9:case\"end\":return _context2.stop();}}},_callee2,null,[[0,6]]);}));return function viewIntro(_x){return _ref3.apply(this,arguments);};}();return/*#__PURE__*/_jsx(ConfigProvider,{children:/*#__PURE__*/_jsx(AdaptivityProvider,{children:/*#__PURE__*/_jsx(AppRoot,{children:/*#__PURE__*/_jsx(SplitLayout,{popout:popout,children:/*#__PURE__*/_jsx(SplitCol,{children:/*#__PURE__*/_jsxs(View,{activePanel:activePanel,children:[/*#__PURE__*/_jsx(Home,{id:ROUTES.HOME,fetchedUser:fetchedUser,go:go}),/*#__PURE__*/_jsx(ChooseFriend,{id:ROUTES.CHOOSEFRIEND,go:go,activePanel:activePanel})]})})})})})});};export default App;","map":{"version":3,"names":["bridge","React","useState","useEffect","ChooseFriend","View","ScreenSpinner","AdaptivityProvider","AppRoot","ConfigProvider","SplitLayout","SplitCol","Home","App","ROUTES","HOME","CHOOSEFRIEND","STORAGE_KEYS","STATE","STATUS","activePanel","setActivePanel","fetchedUser","setUser","popout","setPopout","fetchedState","setFetchedState","userHasSeenIntro","setUserHasSeenIntro","subscribe","detail","type","data","schemeAttribute","document","createAttribute","value","scheme","body","attributes","setNamedItem","fetchData","send","user","keys","sheetState","Array","isArray","forEach","key","JSON","parse","hasSeenIntro","error","setSnackbar","backgroundColor","go","e","currentTarget","dataset","to","viewIntro","panel","stringify"],"sources":["C:/Users/Alice/Desktop/vk4/who/src/App.js"],"sourcesContent":["import './App.css'\nimport '@vkontakte/vkui/dist/vkui.css';\nimport bridge from '@vkontakte/vk-bridge';\nimport React, { useState, useEffect } from 'react';\nimport { ChooseFriend } from './components/choosеFriend/СhooseFriend';\nimport { View, ScreenSpinner, AdaptivityProvider, AppRoot, ConfigProvider, SplitLayout, SplitCol } from '@vkontakte/vkui';\nimport Home from './components/home/Home';\n\nconst App = () => {\n\tconst ROUTES = {\n\t\tHOME: 'home',\n\t\tCHOOSEFRIEND: 'chooseFriend',\n\t};\n\n\tconst STORAGE_KEYS = {\n\t\tSTATE: 'state',\n\t\tSTATUS: 'viewStatus',\n\t};\n\n\tconst [activePanel, setActivePanel] = useState(ROUTES.HOME);\n\tconst [fetchedUser, setUser] = useState(null);\n\tconst [popout, setPopout] = useState(<ScreenSpinner size='large' />);\n\tconst [fetchedState, setFetchedState] = useState(null);\n\tconst [userHasSeenIntro, setUserHasSeenIntro] = useState(false);\n\n\tuseEffect(() => {\n\t\tbridge.subscribe(({ detail: { type, data } }) => {\n\t\t\tif (type === 'VKWebAppUpdateConfig') {\n\t\t\t\tconst schemeAttribute = document.createAttribute('scheme');\n\t\t\t\tschemeAttribute.value = data.scheme ? data.scheme : 'client_light';\n\t\t\t\tdocument.body.attributes.setNamedItem(schemeAttribute);\n\t\t\t}\n\t\t});\n\t\tasync function fetchData() {\n\t\t\tconst user = await bridge.send('VKWebAppGetUserInfo');\n\t\t\tconst sheetState = await bridge.send('VKWebAppStorageGet', { keys: [STORAGE_KEYS.STATE, STORAGE_KEYS.STATUS] });\n\t\t\tif (Array.isArray(sheetState.keys)) {\n\t\t\t\tconst data = {};\n\t\t\t\tsheetState.keys.forEach(({ key, value }) => {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tdata[key] = value ? JSON.parse(value) : {};\n\t\t\t\t\t\tswitch (key) {\n\t\t\t\t\t\t\tcase STORAGE_KEYS.STATE:\n\t\t\t\t\t\t\t\tsetFetchedState(data[STORAGE_KEYS.STATE]);\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase STORAGE_KEYS.STATUS:\n\t\t\t\t\t\t\t\tif (data[key] && data[key].hasSeenIntro) {\n\t\t\t\t\t\t\t\t\tsetActivePanel(ROUTES.HOME);\n\t\t\t\t\t\t\t\t\tsetUserHasSeenIntro(true);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tsetSnackbar(<Snackbar\n\t\t\t\t\t\t\tlayout='vertical'\n\t\t\t\t\t\t\tonClose={() => setSnackbar(null)}\n\t\t\t\t\t\t\tbefore={<Avatar size={24} style={{ backgroundColor: 'var(--dynamic_red)' }}><Icon24Error fill='#fff' width={14} height={14} /></Avatar>}\n\t\t\t\t\t\t\tduration={900}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tПроблема с получением данных из Storage\n\t\t\t\t\t\t</Snackbar>\n\t\t\t\t\t\t);\n\t\t\t\t\t\tsetFetchedState({});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tsetFetchedState({});\n\t\t\t}\n\t\t\tsetUser(user);\n\t\t\tsetPopout(null);\n\t\t}\n\t\tfetchData();\n\t}, []);\n\n\n\tconst go = e => {\n\t\tsetActivePanel(e.currentTarget.dataset.to);\n\t};\n\n\tconst viewIntro = async (panel) => {\n\t\ttry {\n\t\t\tawait bridge.send('VKWebAppStorageSet', {\n\t\t\t\tkey: STORAGE_KEYS.STATUS,\n\t\t\t\tvalue: JSON.stringify({\n\t\t\t\t\thasSeenIntro: true,\n\t\t\t\t}),\n\t\t\t});\n\t\t\tgo(panel);\n\t\t} catch (error) {\n\t\t\tsetSnackbar(<Snackbar\n\t\t\t\tlayout='vertical'\n\t\t\t\tonClose={() => setSnackbar(null)}\n\t\t\t\tbefore={<Avatar size={24} style={{ backgroundColor: 'var(--dynamic_red)' }}><Icon24Error fill='#fff' width={14} height={14} /></Avatar>}\n\t\t\t\tduration={900}\n\t\t\t>\n\t\t\t\tПроблема с отправкой данных в Storage\n\t\t\t</Snackbar>\n\t\t\t);\n\t\t}\n\t}\n\n\treturn (\n\t\t<ConfigProvider>\n\t\t\t<AdaptivityProvider>\n\t\t\t\t<AppRoot>\n\t\t\t\t\t<SplitLayout popout={popout}>\n\t\t\t\t\t\t<SplitCol>\n\t\t\t\t\t\t\t<View activePanel={activePanel}>\n\t\t\t\t\t\t\t\t<Home id={ROUTES.HOME} fetchedUser={fetchedUser} go={go} />\n\t\t\t\t\t\t\t\t<ChooseFriend id={ROUTES.CHOOSEFRIEND} go={go} activePanel={activePanel} />\n\t\t\t\t\t\t\t</View>\n\t\t\t\t\t\t</SplitCol>\n\t\t\t\t\t</SplitLayout>\n\t\t\t\t</AppRoot>\n\t\t\t</AdaptivityProvider>\n\t\t</ConfigProvider>\n\t);\n}\n\nexport default App;\n"],"mappings":"yWAAA,MAAO,WAAP,CACA,MAAO,+BAAP,CACA,MAAOA,OAAP,KAAmB,sBAAnB,CACA,MAAOC,MAAP,EAAgBC,QAAhB,CAA0BC,SAA1B,KAA2C,OAA3C,CACA,OAASC,YAAT,KAA6B,wCAA7B,CACA,OAASC,IAAT,CAAeC,aAAf,CAA8BC,kBAA9B,CAAkDC,OAAlD,CAA2DC,cAA3D,CAA2EC,WAA3E,CAAwFC,QAAxF,KAAwG,iBAAxG,CACA,MAAOC,KAAP,KAAiB,wBAAjB,C,wFAEA,GAAMC,IAAG,CAAG,QAANA,IAAM,EAAM,CACjB,GAAMC,OAAM,CAAG,CACdC,IAAI,CAAE,MADQ,CAEdC,YAAY,CAAE,cAFA,CAAf,CAKA,GAAMC,aAAY,CAAG,CACpBC,KAAK,CAAE,OADa,CAEpBC,MAAM,CAAE,YAFY,CAArB,CAKA,cAAsCjB,QAAQ,CAACY,MAAM,CAACC,IAAR,CAA9C,wCAAOK,WAAP,eAAoBC,cAApB,eACA,eAA+BnB,QAAQ,CAAC,IAAD,CAAvC,yCAAOoB,WAAP,eAAoBC,OAApB,eACA,eAA4BrB,QAAQ,cAAC,KAAC,aAAD,EAAe,IAAI,CAAC,OAApB,EAAD,CAApC,yCAAOsB,MAAP,eAAeC,SAAf,eACA,eAAwCvB,QAAQ,CAAC,IAAD,CAAhD,yCAAOwB,YAAP,eAAqBC,eAArB,eACA,eAAgDzB,QAAQ,CAAC,KAAD,CAAxD,0CAAO0B,gBAAP,gBAAyBC,mBAAzB,gBAEA1B,SAAS,CAAC,UAAM,CACfH,MAAM,CAAC8B,SAAP,CAAiB,cAAgC,sBAA7BC,MAA6B,CAAnBC,IAAmB,aAAnBA,IAAmB,CAAbC,IAAa,aAAbA,IAAa,CAChD,GAAID,IAAI,GAAK,sBAAb,CAAqC,CACpC,GAAME,gBAAe,CAAGC,QAAQ,CAACC,eAAT,CAAyB,QAAzB,CAAxB,CACAF,eAAe,CAACG,KAAhB,CAAwBJ,IAAI,CAACK,MAAL,CAAcL,IAAI,CAACK,MAAnB,CAA4B,cAApD,CACAH,QAAQ,CAACI,IAAT,CAAcC,UAAd,CAAyBC,YAAzB,CAAsCP,eAAtC,EACA,CACD,CAND,EADe,QAQAQ,UARA,qIAQf,kLACoB1C,OAAM,CAAC2C,IAAP,CAAY,qBAAZ,CADpB,QACOC,IADP,qCAE0B5C,OAAM,CAAC2C,IAAP,CAAY,oBAAZ,CAAkC,CAAEE,IAAI,CAAE,CAAC5B,YAAY,CAACC,KAAd,CAAqBD,YAAY,CAACE,MAAlC,CAAR,CAAlC,CAF1B,QAEO2B,UAFP,eAGC,GAAIC,KAAK,CAACC,OAAN,CAAcF,UAAU,CAACD,IAAzB,CAAJ,CAAoC,CAC7BZ,IAD6B,CACtB,EADsB,CAEnCa,UAAU,CAACD,IAAX,CAAgBI,OAAhB,CAAwB,eAAoB,IAAjBC,IAAiB,OAAjBA,GAAiB,CAAZb,KAAY,OAAZA,KAAY,CAC3C,GAAI,CACHJ,IAAI,CAACiB,GAAD,CAAJ,CAAYb,KAAK,CAAGc,IAAI,CAACC,KAAL,CAAWf,KAAX,CAAH,CAAuB,EAAxC,CACA,OAAQa,GAAR,EACC,IAAKjC,aAAY,CAACC,KAAlB,CACCS,eAAe,CAACM,IAAI,CAAChB,YAAY,CAACC,KAAd,CAAL,CAAf,CACA,MACD,IAAKD,aAAY,CAACE,MAAlB,CACC,GAAIc,IAAI,CAACiB,GAAD,CAAJ,EAAajB,IAAI,CAACiB,GAAD,CAAJ,CAAUG,YAA3B,CAAyC,CACxChC,cAAc,CAACP,MAAM,CAACC,IAAR,CAAd,CACAc,mBAAmB,CAAC,IAAD,CAAnB,CACA,CACD,MACD,QACC,MAXF,CAaA,CAAC,MAAOyB,KAAP,CAAc,CACfC,WAAW,cAAC,KAAC,QAAD,EACX,MAAM,CAAC,UADI,CAEX,OAAO,CAAE,yBAAMA,YAAW,CAAC,IAAD,CAAjB,EAFE,CAGX,MAAM,cAAE,KAAC,MAAD,EAAQ,IAAI,CAAE,EAAd,CAAkB,KAAK,CAAE,CAAEC,eAAe,CAAE,oBAAnB,CAAzB,uBAAoE,KAAC,WAAD,EAAa,IAAI,CAAC,MAAlB,CAAyB,KAAK,CAAE,EAAhC,CAAoC,MAAM,CAAE,EAA5C,EAApE,EAHG,CAIX,QAAQ,CAAE,GAJC,4LAAD,CAAX,CASA7B,eAAe,CAAC,EAAD,CAAf,CACA,CACD,CA5BD,EA6BA,CA/BD,IA+BO,CACNA,eAAe,CAAC,EAAD,CAAf,CACA,CACDJ,OAAO,CAACqB,IAAD,CAAP,CACAnB,SAAS,CAAC,IAAD,CAAT,CAtCD,sDARe,4CAgDfiB,SAAS,GACT,CAjDQ,CAiDN,EAjDM,CAAT,CAoDA,GAAMe,GAAE,CAAG,QAALA,GAAK,CAAAC,CAAC,CAAI,CACfrC,cAAc,CAACqC,CAAC,CAACC,aAAF,CAAgBC,OAAhB,CAAwBC,EAAzB,CAAd,CACA,CAFD,CAIA,GAAMC,UAAS,2FAAG,kBAAOC,KAAP,8JAEV/D,OAAM,CAAC2C,IAAP,CAAY,oBAAZ,CAAkC,CACvCO,GAAG,CAAEjC,YAAY,CAACE,MADqB,CAEvCkB,KAAK,CAAEc,IAAI,CAACa,SAAL,CAAe,CACrBX,YAAY,CAAE,IADO,CAAf,CAFgC,CAAlC,CAFU,QAQhBI,EAAE,CAACM,KAAD,CAAF,CARgB,kFAUhBR,WAAW,cAAC,KAAC,QAAD,EACX,MAAM,CAAC,UADI,CAEX,OAAO,CAAE,yBAAMA,YAAW,CAAC,IAAD,CAAjB,EAFE,CAGX,MAAM,cAAE,KAAC,MAAD,EAAQ,IAAI,CAAE,EAAd,CAAkB,KAAK,CAAE,CAAEC,eAAe,CAAE,oBAAnB,CAAzB,uBAAoE,KAAC,WAAD,EAAa,IAAI,CAAC,MAAlB,CAAyB,KAAK,CAAE,EAAhC,CAAoC,MAAM,CAAE,EAA5C,EAApE,EAHG,CAIX,QAAQ,CAAE,GAJC,gLAAD,CAAX,CAVgB,qEAAH,kBAATM,UAAS,6CAAf,CAsBA,mBACC,KAAC,cAAD,wBACC,KAAC,kBAAD,wBACC,KAAC,OAAD,wBACC,KAAC,WAAD,EAAa,MAAM,CAAEtC,MAArB,uBACC,KAAC,QAAD,wBACC,MAAC,IAAD,EAAM,WAAW,CAAEJ,WAAnB,wBACC,KAAC,IAAD,EAAM,EAAE,CAAEN,MAAM,CAACC,IAAjB,CAAuB,WAAW,CAAEO,WAApC,CAAiD,EAAE,CAAEmC,EAArD,EADD,cAEC,KAAC,YAAD,EAAc,EAAE,CAAE3C,MAAM,CAACE,YAAzB,CAAuC,EAAE,CAAEyC,EAA3C,CAA+C,WAAW,CAAErC,WAA5D,EAFD,GADD,EADD,EADD,EADD,EADD,EADD,CAgBA,CA/GD,CAiHA,cAAeP,IAAf"},"metadata":{},"sourceType":"module"}